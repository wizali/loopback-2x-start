!function(e,o){"use strict";function l(){}function t(){}function n(){var e={};this.$get=function(){return e},this.preinit=function(l,t){return o.isDefined(l)&&o.isDefined(t)&&(e[l]=t),this}}var c=["phoebe.utils","phoebe.httpService","phoebe.resource","phoebe.dict","phoebe.controller"],i={},r={};o.module("phoebe",c).constant("PhoebeCons",i).value("PhoebeContext",r).config(l).provider("$phoebe",n).run(t).directive("levelOne",["$compile",function(e){return{restrict:"E",scope:!0,transclude:"tEle",compile:function(o){return console.log("compile→levelOne"+o.html()),{pre:function(e,o){console.log("pre→levelOne"+o.html())},post:function(o,l){l.append("<level:two></level:two>"),e(l),console.log("post→levelOne"+l.html())}}}}}]).directive("levelTwo",function(){return{restrict:"E",scope:!0,transclude:"tEle",compile:function(e){return e.append("<level:three></level:three>"),console.log("compile→levelTwo"+e.html()),{pre:function(e,o){console.log("pre→levelTwo"+o.html())},post:function(e,o){console.log("post→levelTwo"+o.html())}}}}}).directive("levelThree",function(){return{restrict:"E",template:"hello,111111",scope:!0,transclude:"tEle",compile:function(e){return console.log("compile→levelThree"+e.html()),{pre:function(e,o){console.log("pre→levelThree"+o.html())},post:function(e,o){console.log("post→levelThree"+o.html())}}}}}),l.$inject=[],t.$inject=[],n.$inject=[]}(window,window.angular);
!function(t,e){"use strict";function n(t){return function(e,n){n||(n="yyyy-MM-dd");var s=new RegExp("^[0-9]*$");return s.test(e)&&10===e.toString().length&&(e=1e3*e),t.getDate(e,n)}}function s(t){return function(e,n,s,i){e=Number(e),i=i?i:"byte",n=n?n:1;var r,o=new RegExp("^[0-9]*$");if(o.test(e))switch(i){case"byte":r=t.toByteConv(e,s,n);break;case"hz":r=t.toFrequencyConv(e,s,n)}else r=e;return r}}function i(){this.$get=function(){return this},this.toSeconds=function(t){return t?(13==t.toString().length?t=Math.floor(t/1e3):10==t.toString().length&&(t=1e3*t),t):0},this.getDate=function(t,e){t=t?new Date(t):new Date,e||(e="yyyy-MM-dd hh:mm:ss.S [T]");var n={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds(),T:t.getTime()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));for(var s in n)new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[s]:("00"+n[s]).substr((""+n[s]).length)));return e},this.getTodayTimeInterval=function(){var t={},e=new Date;e.setHours(0,0,0,0),t.startTime=e.getTime();var n=new Date;return n.setHours(24,0,0,0),t.endTime=n.getTime(),t},this.getMonthTimeInterval=function(){var t={},e=new Date;e.setDate(1),e.setHours(0,0,0,0),t.startTime=e.getTime();var n=new Date;return n.setMonth(n.getMonth()+1,0),n.setHours(24,0,0,0),t.endTime=n.getTime(),t},this.getYearTimeInterval=function(){var t={},e=new Date;e.setMonth(0,1),e.setHours(0,0,0,0),t.startTime=e.getTime();var n=new Date;return n.setMonth(12,0),n.setHours(24,0,0,0),t.endTime=n.getTime(),t},this.getWeekTimeInterval=function(){var t=0===(new Date).getDay()?!0:!1,e={},n=new Date;t?(n.setDate(n.getDate()-6),n.setHours(0,0,0,0)):(n.setDate(n.getDate()-n.getDay()+1),n.setHours(0,0,0,0)),e.startTime=n.getTime();var s=new Date;return t?s.setHours(24,0,0,0):(s.setDate(n.getDate()+(7-n.getDay())),s.setHours(24,0,0,0)),e.endTime=s.getTime(),e}}function r(){this.$get=function(){return this},this.toUtilization=function(t){return t?(t/100).toFixed(1):0},this.sizeConversion=function(t,e,n,s,i){if(!t)return 0;e=e?e:i[0],n=n?n:1,s=s?s:"auto";var r=i.indexOf(e);for("auto"!=s&&(s=i.indexOf(s));t>=1024&&(t/=1024,r++,r!=s););return t.toFixed(n)+i[r]},this.toByteConv=function(t,e,n,s){var i=["B","KB","MB","GB","TB","PB","EB"];return this.sizeConversion(t,e,n,s,i)},this.toFrequencyConv=function(t,e,n,s){var i=["Hz","KHz","MHz","GHz","THz","PHz","EHz"];return this.sizeConversion(t,e,n,s,i)}}function o(){function t(){return this.keys=[],this.values={},this.put=function(t,e){this.hasOwnKey(t)||this.keys.push(t),this.values[t]=e},this.get=function(t){return this.values[t]},this.remove=function(t){var e=this.keys.indexOf(t);e>-1&&this.keys.splice(e,1),delete this.values[t]},this.each=function(t){if("function"==typeof t)for(var e=this.keys.length,n=0;e>n;n++){var s=this.keys[n];t(s,this.values[s],n)}},this.entrys=function(){for(var t=this.keys.length,e=new Array(t),n=0;t>n;n++){var s=this.keys[n];e[n]={key:s,value:this.values[s]}}return e},this.element=function(t){var e=this.keys.length;return t>=e?null:{key:this.keys[t],value:this.values[this.keys[t]]}},this.sortASC=function(){return this.keys.sort(function(t,e){return t>e?1:-1}),this.entrys()},this.sortDESC=function(){return this.keys.sort(function(t,e){return e>t?1:-1})},this.hasOwnKey=function(t){return this.values.hasOwnProperty(t)},this.clear=function(){this.keys=[],this.values={}},this.isEmpty=function(){return 0===this.keys.length},this.size=function(){return this.keys.length},this}return t}e.module("phoebe.utils",[]).provider("DateFormat",i).provider("MeasureFormat",r).filter("dateFormat",n).filter("measureFormat",s).factory("Map",o),n.$inject=["DateFormat"],s.$inject=["MeasureFormat"]}(window,window.angular);

!function(e,n,r){"use strict";function t(e,r,t,o){n.isArray(e)&&r.preload(e).success(function(e){n.forEach(e,function(e){var n=e[r.getForeignKey()];t[n]=e}),o(s.DICT_LOADED,!0)}).error(function(e){t.error=e,o(s.DICT_LOADED,!1)})}function o(e,t,o,i,c,a){if(n.isArray(e)){var f=[];n.forEach(e,function(e){if(e.hasOwnProperty("model")){var n=e.model.match(u)[0];if(c[n]=new t(e.model,e.hasOwnProperty("PK")?e.PK:r),e.hasOwnProperty("trigger"))e.hasOwnProperty("name")&&(i[e.name]=[]),c[e.name+"Trigger"]=function(r){if(e.hasOwnProperty("wherestr"))e.wherestr.hasOwnProperty("where")||(e.wherestr.where={}),e.wherestr.where[e.trigger]=r;else{var t={};t.where={},t.where[e.trigger]=r,e.wherestr=t}var o=c[n].query(e.wherestr);return o.success(function(r){i[e.name]=r,i[e.name].PK=c[n].pkfield}),o};else{var o={};e.hasOwnProperty("wherestr")&&(o=e.wherestr);var s=c[n].query(o);s.success(function(r){e.hasOwnProperty("name")&&(i[e.name]=r,i[e.name].PK=c[n].pkfield)}),f.push(s)}}});var O=o.all(f);O.then(function(){a(s.OPTION_LOADED,!0)},function(){a(s.OPTION_LOADED,!1)})}}function i(e,t,o,i,c,u,f,O){function D(e,r,t){if(n.isDefined(e)&&n.isDefined(r)&&n.isDefined(t)&&u.hasOwnProperty(r))for(var o=0;o<u[r].length;o++){var i=u[r].PK?u[r].PK:"id";if(e==u[r][o][i]){u[r].selectedItem=u[r][o],u[r].linkname=t;break}}}function d(){A(),I.trigger=a.ADDING,I.optype=a.ADDING,f(s.MODEL_OPERATION,I)}function p(e){g=e,c[t]=n.copy(c[o][e]),I.trigger=a.MODIFYING,I.optype=a.MODIFYING,I.index=e,f(s.MODEL_OPERATION,I)}function E(){I.optype=a.SAVING;var e=f(s.MODEL_OPERATION,I);e.defaultPrevented&&l()}function l(){e[t].save([c[t]]).success(function(r){e[t].hasOwnProperty("include")&&n.forEach(e[t].include,function(e){r[0][e]=c[t][e];for(var n in u)u[n].hasOwnProperty("linkname")&&e==u[n].linkname&&u[n].selectedItem&&(r[0][e]=u[n].selectedItem,u[n].selectedItem=null)});var i=I.trigger==a.MODIFYING;i?c[o][g]=r[0]:c[o].unshift(r[0]),I.success=!0,I.data=r[0],A(),I.optype=a.SAVED,f(s.MODEL_OPERATION,I)}).error(function(){I.optype=a.SAVED,f(s.MODEL_OPERATION,I)})}function h(e){I.optype=a.REMOVING,I.index=e;var n=f(s.MODEL_OPERATION,I);n.defaultPrevented&&y(e)}function y(n){e[t].delete([c[o][n][O]]).success(function(){I.success=!0,I.data=c[o][n],c[o].splice(n,1)}).error(function(e){I.success=!1,I.data=e}).then(function(){I.optype=a.DELETED,f(s.MODEL_OPERATION,I)})}function P(e){var n=c[i].indexOf(e);0>n?c[i].push(e):c[i].splice(n,1)}function v(){I.optype=a.BATCH_REMOVING;var e=f(s.MODEL_OPERATION,I);e.defaultPrevented&&w()}function w(){if(0!==c[i].length){I.optype=a.DELETED;var r=[];n.forEach(c[i],function(e){e.hasOwnProperty(O)&&r.push(e[O])}),e[t].delete(r).success(function(e){n.forEach(c[i],function(e){var n=c[o].indexOf(e);c[o].splice(n,1)}),c[i]=[],I.success=!0,I.data=e}).error(function(e){I.success=!1,I.data=e}).then(function(){c[i]=[],f(s.MODEL_OPERATION,I)})}}function L(n){var i=n.pagination||r,a=n.wherestr||e[t].wherestr||{};try{delete a.count}catch(u){}if(i){var O=i.page,D=i.rows,d=D,p=(O-1)*D;a.limit=d,a.skip=p}else delete a.limit,delete a.skip;e[t].query(a).success(function(e){c[o]=e,I.success=!0,f(s.MODEL_LOADED,I)}).error(function(){f(s.MODEL_LOADED,I)}),i&&(a.count=!0,e[t].query(a).success(function(n){e[t+"Count"]=n.count,f(s.MODEL_LOADED,I)}).error(function(){f(s.MODEL_LOADED,I)}))}function A(){c[t]=null,I.optype=a.RESET,f(s.MODEL_OPERATION,I)}var I={success:!1,model:t,optype:null,trigger:null,data:null},m={Add:d,Modify:p,Saving:E,Save:l,Reset:A,Remove:h,Delete:y,MarkSelected:P,BatchRemove:v,BatchDelete:w,QueryData:L};n.forEach(m,function(n,r){var o=t+r;e[o]=n}),e.setSelected=D;var g}function c(e,c,u){function f(e,r){return n.isDefined(p)?p.$broadcast(e,r):void 0}function O(r,i){if(n.isDefined(r)&&n.isDefined(i))switch(r){case"dict":t(i,e,E,f);break;case"options":o(i,c,u,E,h,f)}}function D(e,t){if(n.isDefined(e)&&n.isDefined(t)&&t.hasOwnProperty("model")){var o=t.hasOwnProperty("PK")?t.PK:"id",a=e+"DataSource",u=e+"SelectedItems";l[e]={},l[a]=[],l[u]=[];var O=new c(t.model,o);if(t.hasOwnProperty("interface")){var D=n.isArray(t.interface);D?n.forEach(t.interface,function(e){O.setInterface(e)}):O.setInterface(t.interface)}var d=t.hasOwnProperty("wherestr")?t.wherestr:r,p={model:e,success:!1};if(t.hasOwnProperty("pagination")){var y=t.pagination.page,P=t.pagination.rows,v=P,w=(y-1)*P;v&&w!==r&&(d.limit=v,d.skip=w)}O.query(d).success(function(n){l[a]=n,h[e]=O,i(h,e,a,u,l,E,f,o),p.success=!0,f(s.MODEL_LOADED,p)}).error(function(){f(s.MODEL_LOADED,p)}),t.hasOwnProperty("pagination")&&(d.count=!0,O.query(d).success(function(n){h[e+"Count"]=n.count,p.success=!0,f(s.MODEL_LOADED,p)}).error(function(){f(s.MODEL_LOADED,p)}))}}function d(e){n.isObject(e)&&e.hasOwnProperty("$id")&&(p=e,E=p.$dataProvider={},l=p.$model={},h=p.$resoure={})}var p,E,l,h;return n.forEach(s,function(e,n){d.prototype[n]=e}),d.prototype.optype=a,d.prototype.preload=function(e,n){return O(e,n),this},d.prototype.createModel=function(e,n){return D(e,n),this},d}var s={DICT_LOADED:"dictLoadingCompleted",OPTION_LOADED:"optionLoadingCompleted",MODEL_LOADED:"modelLoadingCompleted",MODEL_OPERATION:"modelOperation"},a={ADDING:"adding",MODIFYING:"modifying",SAVING:"saving",SAVED:"saved",REMOVING:"removing",DELETED:"deleted",BATCH_REMOVING:"batchRemoving",BATCH_DELETED:"batchDeleted",RESET:"reset"},u=new RegExp("[^/]+");n.module("phoebe.controller",[]).service("PhoebeController",c),c.$inject=["PhoebeDict","PhoebeResource","$q"]}(window,window.angular,void 0);
!function(e,r){function n(e){var n=[];if(!r.isArray(e))return{err:"To load the data dictionary are failure!"};var t={or:[],include:[f]};if(r.forEach(e,function(e){if(i(e))n.push(h[e]);else{var r={};r[s]=e,t.or.push(r)}}),!c)return o('The resource of the dictionary is "undefined".');var u;return t.or.length>0?(u=c.query(t),u.success(function(e){r.forEach(e,function(e){h[e[s]]=e})})):u={success:function(e){return e(n),u},error:function(e){return e(n),u}},u}function t(e,n,t){var o;if(r.isDefined(t)||(t=l),i(e))for(var u=h[e][f],a=0;a<u.length;a++)if(u[a][d]==n){o=u[a][t];break}return o}function i(e){return e&&""!==e?h.hasOwnProperty(e):o('The name of the dictionary is "undefined".')}function o(e){return{error:e}}function u(e,u){if(!e.hasOwnProperty("dict"))return o("Phoebe load failure!");var a=e.dict;return c=new u("/"+a.mainModel),f=a.include,a.hasOwnProperty("foreignKey")&&(s=a.foreignKey?a.foreignKey:s),a.hasOwnProperty("key")&&(d=a.key?a.key:d),a.hasOwnProperty("value")&&(l=a.value?a.value:l),this.preload=function(e){return r.isString(e)&&(e=[e]),n(e)},this.getDict=function(e){return i(e)?h[e]:this.preload(e)},this.getDictValue=function(e,r,n){var u;return u=i(e)?t(e,r,n):o('Not found the value of "'+r+'" on the "'+e+'"!')},this.getForeignKey=function(){return s},this}function a(){return function(e,r,n){if(!e||!r)return e;var i=t(r,e,n);return i?i:e}}var c,f,h={},s="dict",d="key",l="value";r.module("phoebe.dict",[]).factory("PhoebeDict",u).filter("dictFormat",a),u.$inject=["$phoebe","PhoebeResource"],a.$inject=[]}(window,window.angular);
!function(e,r){"use strict";function t(e){var t="";if(e.hasOwnProperty("fkid")&&r.isString(e.fkid)&&(t+="/"+e.fkid),e.hasOwnProperty("hasmany")&&r.isString(e.hasmany)&&(t+="/"+e.hasmany),r.isDefined(e.where)){var n="and";r.isDefined(e.where.logic)&&("and"==e.where.logic&&(n="and"),"or"==e.where.logic&&(n="or"));var i=0;r.forEach(e.where,function(r,o){"logic"!=o&&(t+=-1===t.indexOf("?")?"?":"&",t+=1===Object.keys(e.where).length?e.count?"where["+o+"]="+r:"filter[where]["+o+"]="+r:e.count?"where["+n+"]["+i+"]["+o+"]="+r:"filter[where]["+n+"]["+i+"]["+o+"]="+r,i++)})}return r.isDefined(e.or)&&r.isArray(e.or)&&r.forEach(e.or,function(e,n){r.forEach(e,function(e,r){t+=-1===t.indexOf("?")?"?":"&",t+="filter[where][or]["+n+"]["+r+"]="+e})}),r.isDefined(e.and)&&r.isArray(e.and)&&r.forEach(e.and,function(e,n){r.forEach(e,function(e,r){t+=-1===t.indexOf("?")?"?":"&",t+="filter[where][and]["+n+"]["+r+"]="+e})}),r.isDefined(e.neq)&&r.isArray(e.neq)&&r.forEach(e.neq,function(e){r.forEach(e,function(e,r){t+=-1===t.indexOf("?")?"?":"&",t+="filter[where]["+r+"][neq]="+e})}),r.isArray(e.include)&&r.forEach(e.include,function(e){t+=-1===t.indexOf("?")?"?":"&",t+="filter[include]="+e}),r.isDefined(e.between)&&Object.keys(e.between).length>1&&r.isArray(e.between.val)&&(t+=-1===t.indexOf("?")?"?":"&",t+="filter[where]["+e.between.field+"][between][0]="+e.between.val[0],t+="&filter[where]["+e.between.field+"][between][1]="+e.between.val[1]),r.isDefined(e.order)&&(t+=-1===t.indexOf("?")?"?":"&",r.isDefined(e.order.field)&&(t+="filter[order]="+e.order.field),t+=r.isDefined(e.order.val)?" "+e.order.val:" DESC"),r.isNumber(e.limit)&&(t+=-1===t.indexOf("?")?"?":"&",t+="filter[limit]="+e.limit),r.isNumber(e.skip)&&(t+=-1===t.indexOf("?")?"?":"&",t+="filter[skip]="+e.skip),r.isDefined(e.like)&&r.isDefined(e.like.field)&&r.isDefined(e.like.val)&&(t+=-1===t.indexOf("?")?"?":"&",t+="filter[where]["+e.like.field+"][like]="+e.like.val),r.isDefined(e.lt)&&r.isDefined(e.lt.field)&&r.isDefined(e.lt.val)&&(t+=-1===t.indexOf("?")?"?":"&",t+="filter[where]["+e.lt.field+"][lt]="+e.lt.val),r.isDefined(e.gt)&&r.isDefined(e.gt.field)&&r.isDefined(e.gt.val)&&(t+=-1===t.indexOf("?")?"?":"&",t+="filter[where]["+e.gt.field+"][gt]="+e.gt.val),t}function n(e){var r=new RegExp("[^/]+"),t=e.match(r)[0];return e.replace(t,i(t))}function i(e){return inflection.pluralize(e)}function o(e,t){var n=e.all(t);return n.success=function(e){return n.then(function(t){var n=[];r.forEach(t,function(e){""===e.data?n.push(e.status):n.push(e.data)}),e(n)}),n},n.error=function(e){return n.then(null,function(t){var n=[];r.forEach(t,function(e){n.push(e.status)}),e(n)}),n},n}function f(e){return e.then(function(e){u(e)},function(e){s(e)}),e}function u(e){return e}function s(e){var r;switch(e.status){case 404:r="请求的远端服务不存在!";break;case 500:r="请求的远程服务出错！"}console.log("[http request error]: "+r)}function c(){}function a(e,i,u){function s(i,o){if(r.isString(i)&&""!==i){var s=u.serverUrl+n(i);return r.isObject(o)&&!r.isArray(o)&&(o.hasOwnProperty("count")&&(s+="/count"),s+=t(o)),f(e.get(s))}}function c(t,i){if(r.isString(t)&&""!==t&&r.isArray(i)){var o=u.serverUrl+n(t);return f(e.post(o,i))}}function a(t,f){if(r.isString(t)&&""!==t&&r.isArray(f)){var s=u.serverUrl+n(t),c=[];return r.forEach(f,function(r){c.push(e.put(s,r))}),o(i,c)}}function l(t,f){function c(t){var n=[];return r.forEach(t,function(t){var i;r.isString(t)?i=e.delete(a+"/"+t):r.isObject(t)&&(i=e.delete(a+"/"+t.id)),n.push(i)}),n}if(r.isString(t)&&""!==t){var a=u.serverUrl+n(t);if(r.isArray(f))return o(i,c(f));if(r.isObject(f)){var l,h,d=s(t,f);return d.success=function(e){return l=e,d},d.error=function(e){return h=e,d},d.then(function(e){var t=e.data;d=i.all(c(t)),d.then(function(e){var t=[];r.forEach(e,function(e){t.push(e.status)}),l(t)},function(e){var t=[];r.forEach(e,function(e){t.push(e.status)}),h(t)})}),d}}}function h(i,o,s,c,a){if(r.isString(i)&&""!==i){var l=u.serverUrl+n(i);r.isObject(c)&&!r.isArray(c)&&(l+=t(c));var h;if(s)switch(l=l+"/"+a,o.toLowerCase()){case"get":h=e.get(l);break;case"put":h=e.put(l);break;case"post":h=e.post(l);break;case"del":h=e.delete(l);break;case"delete":h=e.delete(l)}else switch(o.toLowerCase()){case"get":h=e.get(l);break;case"put":h=e.put(l,a);break;case"post":h=e.post(l,a);break;case"del":h=e.delete(l,a);break;case"delete":h=e.delete(l,a)}return f(h)}}function d(){}return u.hasOwnProperty("serverUrl")?(d.find=function(e,r){return s(e,r)},d.create=function(e,r){return c(e,r)},d.update=function(e,r,t){return a(e,r,t)},d.destroy=function(e,r){return l(e,r)},d.customInterface=function(e,r,t,n,i){return h(e,r,t,n,i)},d):"Phoebe load failure!"}function l(e){return d.hasOwnProperty(e)}function h(e){function t(e,t){var n=[];return r.forEach(e,function(e){r.forEach(t,function(r){e.hasOwnProperty(r)&&delete e[r]}),n.push(e)}),n}function n(e,r){return l(e)?d[e]:(this.url=e,this.include=null,this.wherestr=null,this.pkfield=r?r:"id",d[this.url]=this,void 0)}return n.prototype.query=function(t){return r.isObject(t)&&(this.include=t.include,this.wherestr=t),e.find(this.url,t)},n.prototype.save=function(n){return n=r.copy(n),this.include&&(n=t(n,this.include)),e.update(this.url,n,this.pkfield)},n.prototype.delete=function(t){return t=r.copy(t),e.destroy(this.url,t)},n.prototype.setInterface=function(t){var n=this;return r.forEach(t,function(r,t){n[t]=function(n,i){var o=this.url+"/"+t,f=r.hasOwnProperty("method")?r.method:"get",u=r.hasOwnProperty("path")?r.path:!1;return e.customInterface(o,f,u,n,i)}}),d[this.url]=this,this},n}r.module("phoebe.httpService",[]).config(c).factory("PhoebeHttpService",a),c.$inject=["$httpProvider"],a.$inject=["$http","$q","$phoebe"],r.module("phoebe.resource",[]).factory("PhoebeResource",h);var d={};h.$inject=["PhoebeHttpService"]}(window,window.angular);
//# sourceMappingURL=phoebe.min.js.map