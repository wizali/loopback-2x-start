!function(e,o){"use strict";function l(){}function t(){}function n(){var e={};this.$get=function(){return e},this.preinit=function(l,t){return o.isDefined(l)&&o.isDefined(t)&&(e[l]=t),this}}var c=["phoebe.utils","phoebe.httpService","phoebe.resource","phoebe.dict","phoebe.controller"],i={},r={};o.module("phoebe",c).constant("PhoebeCons",i).value("PhoebeContext",r).config(l).provider("$phoebe",n).run(t).directive("levelOne",["$compile",function(e){return{restrict:"E",scope:!0,transclude:"tEle",compile:function(o){return console.log("compile→levelOne"+o.html()),{pre:function(e,o){console.log("pre→levelOne"+o.html())},post:function(o,l){l.append("<level:two></level:two>"),e(l),console.log("post→levelOne"+l.html())}}}}}]).directive("levelTwo",function(){return{restrict:"E",scope:!0,transclude:"tEle",compile:function(e){return e.append("<level:three></level:three>"),console.log("compile→levelTwo"+e.html()),{pre:function(e,o){console.log("pre→levelTwo"+o.html())},post:function(e,o){console.log("post→levelTwo"+o.html())}}}}}).directive("levelThree",function(){return{restrict:"E",template:"hello,111111",scope:!0,transclude:"tEle",compile:function(e){return console.log("compile→levelThree"+e.html()),{pre:function(e,o){console.log("pre→levelThree"+o.html())},post:function(e,o){console.log("post→levelThree"+o.html())}}}}}),l.$inject=[],t.$inject=[],n.$inject=[]}(window,window.angular);
!function(e,t){"use strict";function n(e){return function(t,n){n||(n="yyyy-MM-dd");var r=new RegExp("^[0-9]*$");return r.test(t)&&10===t.toString().length&&(t=1e3*t),e.getDate(t,n)}}function r(e){return function(t,n,r,s){t=Number(t),s=s?s:"B",n=n?n:1;var i,o=new RegExp("^[0-9]*$");if(o.test(t))switch(s){case"B":i=e.toByteConv(t,r,n);break;case"hz":i=e.toFrequencyConv(t,r,n)}else i=t;return i}}function s(){this.$get=function(){return this},this.toSeconds=function(e){return e?(13==e.toString().length?e=Math.floor(e/1e3):10==e.toString().length&&(e=1e3*e),e):0},this.getDate=function(e,t){e=e?new Date(e):new Date,t||(t="yyyy-MM-dd hh:mm:ss.S [T]");var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds(),T:e.getTime()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in n)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length)));return t},this.getTodayTimeInterval=function(){var e={},t=new Date;t.setHours(0,0,0,0),e.startTime=t.getTime();var n=new Date;return n.setHours(24,0,0,0),e.endTime=n.getTime(),e},this.getMonthTimeInterval=function(){var e={},t=new Date;t.setDate(1),t.setHours(0,0,0,0),e.startTime=t.getTime();var n=new Date;return n.setMonth(n.getMonth()+1,0),n.setHours(24,0,0,0),e.endTime=n.getTime(),e},this.getYearTimeInterval=function(){var e={},t=new Date;t.setMonth(0,1),t.setHours(0,0,0,0),e.startTime=t.getTime();var n=new Date;return n.setMonth(12,0),n.setHours(24,0,0,0),e.endTime=n.getTime(),e},this.getWeekTimeInterval=function(){var e=0===(new Date).getDay()?!0:!1,t={},n=new Date;e?(n.setDate(n.getDate()-6),n.setHours(0,0,0,0)):(n.setDate(n.getDate()-n.getDay()+1),n.setHours(0,0,0,0)),t.startTime=n.getTime();var r=new Date;return e?r.setHours(24,0,0,0):(r.setDate(n.getDate()+(7-n.getDay())),r.setHours(24,0,0,0)),t.endTime=r.getTime(),t}}function i(){this.$get=function(){return this},this.toUtilization=function(e){return e?(e/100).toFixed(1):0},this.sizeConversion=function(e,t,n,r,s){if(!e)return 0;t=t?t:s[0],n=n?n:1,r=r?r:"auto";var i=s.indexOf(t);for("auto"!==r&&(r=s.indexOf(r));e>=1024&&(e/=1024,i++,i!==r););return e.toFixed(n)+" "+s[i]},this.toByteConv=function(e,t,n,r){var s=["B","KB","MB","GB","TB","PB","EB"];return this.sizeConversion(e,t,n,r,s)},this.toFrequencyConv=function(e,t,n,r){var s=["Hz","KHz","MHz","GHz","THz","PHz","EHz"];return this.sizeConversion(e,t,n,r,s)}}function o(){var e=function(){};return e.keys=[],e.values={},e.put=function(e,t){this.hasOwnKey(e)||this.keys.push(e),this.values[e]=t},e.get=function(e){return this.values[e]},e.remove=function(e){var t=this.keys.indexOf(e);t>-1&&this.keys.splice(t,1),delete this.values[e]},e.each=function(e){if("function"==typeof e)for(var t=this.keys.length,n=0;t>n;n++){var r=this.keys[n];e(r,this.values[r],n)}},e.entrys=function(){for(var e=this.keys.length,t=new Array(e),n=0;e>n;n++){var r=this.keys[n];t[n]={key:r,value:this.values[r]}}return t},e.element=function(e){var t=this.keys.length;return e>=t?null:{key:this.keys[e],value:this.values[this.keys[e]]}},e.sortASC=function(){return this.keys.sort(function(e,t){return e>t?1:-1}),this.entrys()},e.sortDESC=function(){return this.keys.sort(function(e,t){return t>e?1:-1})},e.hasOwnKey=function(e){return this.values.hasOwnProperty(e)},e.clear=function(){this.keys=[],this.values={}},e.isEmpty=function(){return 0===this.keys.length},e.size=function(){return this.keys.length},e}t.module("phoebe.utils",[]).provider("DateFormat",s).provider("MeasureFormat",i).filter("dateFormat",n).filter("measureFormat",r).factory("Map",o),n.$inject=["DateFormat"],r.$inject=["MeasureFormat"]}(window,window.angular);

!function(e,n,r){"use strict";function t(e,r,t,o){e&&r.preload(e).success(function(e){n.forEach(e,function(e){var n=e[r.getForeignKey()];t[n]=e}),o(s.DICT_LOADED,!0)}).error(function(e){t.error=e,o(s.DICT_LOADED,!1)})}function o(e,t,o,i,c,a){if(n.isArray(e)){var f=[];n.forEach(e,function(e){if(e.hasOwnProperty("model")){var n=e.model.match(u)[0];if(c[n]=new t(e.model,e.hasOwnProperty("PK")?e.PK:r),e.hasOwnProperty("trigger"))e.hasOwnProperty("name")&&(i[e.name]=[]),c[e.name+"Trigger"]=function(r){if(e.hasOwnProperty("wherestr"))e.wherestr.hasOwnProperty("where")||(e.wherestr.where={}),e.wherestr.where[e.trigger]=r;else{var t={};t.where={},t.where[e.trigger]=r,e.wherestr=t}var o=c[n].query(e.wherestr);return o.success(function(r){i[e.name]=r,i[e.name].PK=c[n].pkfield}),o};else{var o={};e.hasOwnProperty("wherestr")&&(o=e.wherestr);var s=c[n].query(o);s.success(function(r){e.hasOwnProperty("name")&&(i[e.name]=r,i[e.name].PK=c[n].pkfield)}),f.push(s)}}});var O=o.all(f);O.then(function(){a(s.OPTION_LOADED,!0)},function(){a(s.OPTION_LOADED,!1)})}}function i(e,t,o,i,c,u,f,O){function D(e,r,t){if(n.isDefined(e)&&n.isDefined(r)&&n.isDefined(t)&&u.hasOwnProperty(r))for(var o=0;o<u[r].length;o++){var i=u[r].PK?u[r].PK:"id";if(e==u[r][o][i]){u[r].selectedItem=u[r][o],u[r].linkname=t;break}}}function d(){I(),A.trigger=a.ADDING,A.optype=a.ADDING,f(s.MODEL_OPERATION,A)}function p(e){g=e,c[t]=n.copy(c[o][e]),A.trigger=a.MODIFYING,A.optype=a.MODIFYING,A.index=e,f(s.MODEL_OPERATION,A)}function E(){A.optype=a.SAVING;var e=f(s.MODEL_OPERATION,A);e.defaultPrevented&&l()}function l(){e[t].save([c[t]]).success(function(r){e[t].hasOwnProperty("include")&&n.forEach(e[t].include,function(e){r[0][e]=c[t][e];for(var n in u)u[n].hasOwnProperty("linkname")&&e==u[n].linkname&&u[n].selectedItem&&(r[0][e]=u[n].selectedItem,u[n].selectedItem=null)});var i=A.trigger==a.MODIFYING;i?c[o][g]=r[0]:c[o].unshift(r[0]),A.success=!0,A.data=r[0],I(),A.optype=a.SAVED,f(s.MODEL_OPERATION,A)}).error(function(){A.optype=a.SAVED,f(s.MODEL_OPERATION,A)})}function h(e){A.optype=a.REMOVING,A.index=e;var n=f(s.MODEL_OPERATION,A);n.defaultPrevented&&y(e)}function y(n){e[t].delete([c[o][n][O]]).success(function(){A.success=!0,A.data=c[o][n],c[o].splice(n,1)}).error(function(e){A.success=!1,A.data=e}).then(function(){A.optype=a.DELETED,f(s.MODEL_OPERATION,A)})}function P(e){var n=c[i].indexOf(e);0>n?c[i].push(e):c[i].splice(n,1)}function v(){A.optype=a.BATCH_REMOVING;var e=f(s.MODEL_OPERATION,A);e.defaultPrevented&&w()}function w(){if(0!==c[i].length){A.optype=a.DELETED;var r=[];n.forEach(c[i],function(e){e.hasOwnProperty(O)&&r.push(e[O])}),e[t].delete(r).success(function(e){n.forEach(c[i],function(e){var n=c[o].indexOf(e);c[o].splice(n,1)}),c[i]=[],A.success=!0,A.data=e}).error(function(e){A.success=!1,A.data=e}).then(function(){c[i]=[],f(s.MODEL_OPERATION,A)})}}function L(n){var i=n.pagination||r,a=n.wherestr||e[t].wherestr||{};try{delete a.count}catch(u){}if(i){var O=i.page,D=i.rows,d=D,p=(O-1)*D;a.limit=d,a.skip=p}else delete a.limit,delete a.skip;e[t].query(a).success(function(e){c[o]=e,A.success=!0,f(s.MODEL_LOADED,A)}).error(function(){f(s.MODEL_LOADED,A)}),i&&(a.count=!0,e[t].query(a).success(function(n){e[t+"Count"]=n.count,f(s.MODEL_LOADED,A)}).error(function(){f(s.MODEL_LOADED,A)}))}function I(){c[t]=null,A.optype=a.RESET,f(s.MODEL_OPERATION,A)}var A={success:!1,model:t,optype:null,trigger:null,data:null},m={Add:d,Modify:p,Saving:E,Save:l,Reset:I,Remove:h,Delete:y,MarkSelected:P,BatchRemove:v,BatchDelete:w,QueryData:L};n.forEach(m,function(n,r){var o=t+r;e[o]=n}),e.setSelected=D;var g}function c(e,c,u){function f(e,r){return n.isDefined(p)?p.$broadcast(e,r):void 0}function O(r,i){if(n.isDefined(r)&&n.isDefined(i))switch(r){case"dict":t(i,e,E,f);break;case"options":o(i,c,u,E,h,f)}}function D(e,t){if(n.isDefined(e)&&n.isDefined(t)&&t.hasOwnProperty("model")){var o=t.hasOwnProperty("PK")?t.PK:"id",a=e+"DataSource",u=e+"SelectedItems";l[e]={},l[a]=[],l[u]=[];var O=new c(t.model,o);if(t.hasOwnProperty("interface")){var D=n.isArray(t.interface);D?n.forEach(t.interface,function(e){O.setInterface(e)}):O.setInterface(t.interface)}var d=t.hasOwnProperty("wherestr")?t.wherestr:r,p={model:e,success:!1};if(t.hasOwnProperty("pagination")){var y=t.pagination.page,P=t.pagination.rows,v=P,w=(y-1)*P;v&&w!==r&&(d.limit=v,d.skip=w)}O.query(d).success(function(n){l[a]=n,h[e]=O,i(h,e,a,u,l,E,f,o),p.success=!0,f(s.MODEL_LOADED,p)}).error(function(){f(s.MODEL_LOADED,p)}),t.hasOwnProperty("pagination")&&(d.count=!0,O.query(d).success(function(n){h[e+"Count"]=n.count,p.success=!0,f(s.MODEL_LOADED,p)}).error(function(){f(s.MODEL_LOADED,p)}))}}function d(e){n.isObject(e)&&e.hasOwnProperty("$id")&&(p=e,E=p.$dataProvider={},l=p.$model={},h=p.$resoure=p.$resource={})}var p,E,l,h;return n.forEach(s,function(e,n){d.prototype[n]=e}),d.prototype.optype=a,d.prototype.preload=function(e,n){return O(e,n),this},d.prototype.createModel=function(e,n){return D(e,n),this},d}var s={DICT_LOADED:"dictLoadingCompleted",OPTION_LOADED:"optionLoadingCompleted",MODEL_LOADED:"modelLoadingCompleted",MODEL_OPERATION:"modelOperation"},a={ADDING:"adding",MODIFYING:"modifying",SAVING:"saving",SAVED:"saved",REMOVING:"removing",DELETED:"deleted",BATCH_REMOVING:"batchRemoving",BATCH_DELETED:"batchDeleted",RESET:"reset"},u=new RegExp("[^/]+");n.module("phoebe.controller",[]).service("PhoebeController",c),c.$inject=["PhoebeDict","PhoebeResource","$q"]}(window,window.angular,void 0);
!function(e,r){function n(e){var n=[];if(!r.isArray(e))return{err:"To load the data dictionary are failure!"};var t=[];if(r.forEach(e,function(e){i(e)?n.push(c[e]):t.push(e)}),!f)return o('The resource of the dictionary is "undefined".');var u;return t.length?(u=f.queryKey(null,t),u.then(function(e){return r.forEach(e.data,function(e){c[e[d]]=e}),n.length&&r.forEach(n,function(r){e.data[r[d]]=r}),e})):u={success:function(e){return e(n),u},error:function(e){return e(n),u}},u}function t(e,n,t){var o;if(r.isDefined(t)||(t=s),i(e))for(var u=c[e][h],a=0;a<u.length;a++)if(u[a][l]==n){o=u[a][t];break}return o}function i(e){return e&&""!==e?c.hasOwnProperty(e):o('The name of the dictionary is "undefined".')}function o(e){return{error:e}}function u(e,u){if(!e.hasOwnProperty("dict"))return o("Phoebe load failure!");var a=e.dict;return a.hasOwnProperty("modelName")&&(f=new u("/"+a.modelName),f.setInterface({queryKey:{method:"post"}})),a.hasOwnProperty("foreignKey")&&(d=a.foreignKey?a.foreignKey:d),a.hasOwnProperty("optionsField")&&(h=a.optionsField?a.optionsField:h),a.hasOwnProperty("keyField")&&(l=a.keyField?a.keyField:l),a.hasOwnProperty("valueField")&&(s=a.valueField?a.valueField:s),this.preload=function(e){return r.isString(e)&&(e=[e]),n(e)},this.getDict=function(e){return i(e)?c[e]:this.preload(e)},this.getDictValue=function(e,r,n){var u;return u=i(e)?t(e,r,n):o('Not found the value of "'+r+'" on the "'+e+'"!')},this.getForeignKey=function(){return d},this}function a(){return function(e,r,n){if(!e||!r)return e;var i=t(r,e,n);return i?i:e}}var f,c={},d="dict",h="dictoptions",l="key",s="value";r.module("phoebe.dict",[]).factory("PhoebeDict",u).filter("dictFormat",a),u.$inject=["$phoebe","PhoebeResource"],a.$inject=[]}(window,window.angular);
!function(e,r){"use strict";function t(e){var t="";if(e.hasOwnProperty("fkid")&&r.isString(e.fkid)&&(t+="/"+e.fkid),e.hasOwnProperty("hasmany")&&r.isString(e.hasmany)&&(t+="/"+e.hasmany),r.isDefined(e.where)){var n="and";r.isDefined(e.where.logic)&&("and"===e.where.logic&&(n="and"),"or"===e.where.logic&&(n="or"));var i=0;r.forEach(e.where,function(r,o){"logic"!==o&&(t+=-1===t.indexOf("?")?"?":"&",t+=1===Object.keys(e.where).length?e.count?"where["+o+"]="+r:"filter[where]["+o+"]="+r:e.count?"where["+n+"]["+i+"]["+o+"]="+r:"filter[where]["+n+"]["+i+"]["+o+"]="+r,i++)})}return r.isDefined(e.or)&&r.isArray(e.or)&&r.forEach(e.or,function(e,n){r.forEach(e,function(e,r){t+=-1===t.indexOf("?")?"?":"&",t+="filter[where][or]["+n+"]["+r+"]="+e})}),r.isDefined(e.and)&&r.isArray(e.and)&&r.forEach(e.and,function(e,n){r.forEach(e,function(e,r){t+=-1===t.indexOf("?")?"?":"&",t+="filter[where][and]["+n+"]["+r+"]="+e})}),r.isDefined(e.neq)&&r.isArray(e.neq)&&r.forEach(e.neq,function(e,n){r.forEach(e,function(e,r){t+=-1===t.indexOf("?")?"?":"&",t+="filter[where][and]["+n+"]["+r+"][neq]="+e})}),r.isArray(e.include)&&r.forEach(e.include,function(e){t+=-1===t.indexOf("?")?"?":"&",t+="filter[include]="+e}),r.isDefined(e.between)&&Object.keys(e.between).length>1&&r.isArray(e.between.val)&&(t+=-1===t.indexOf("?")?"?":"&",t+="filter[where]["+e.between.field+"][between][0]="+e.between.val[0],t+="&filter[where]["+e.between.field+"][between][1]="+e.between.val[1]),r.isDefined(e.order)&&(t+=-1===t.indexOf("?")?"?":"&",r.isDefined(e.order.field)&&(t+="filter[order]="+e.order.field),t+=r.isDefined(e.order.val)?" "+e.order.val:" DESC"),r.isNumber(e.limit)&&(t+=-1===t.indexOf("?")?"?":"&",t+="filter[limit]="+e.limit),r.isNumber(e.skip)&&(t+=-1===t.indexOf("?")?"?":"&",t+="filter[skip]="+e.skip),r.isDefined(e.like)&&r.isDefined(e.like.field)&&r.isDefined(e.like.val)&&(t+=-1===t.indexOf("?")?"?":"&",t+="filter[where]["+e.like.field+"][like]="+e.like.val),r.isDefined(e.lt)&&r.isDefined(e.lt.field)&&r.isDefined(e.lt.val)&&(t+=-1===t.indexOf("?")?"?":"&",t+="filter[where]["+e.lt.field+"][lt]="+e.lt.val),r.isDefined(e.gt)&&r.isDefined(e.gt.field)&&r.isDefined(e.gt.val)&&(t+=-1===t.indexOf("?")?"?":"&",t+="filter[where]["+e.gt.field+"][gt]="+e.gt.val),t}function n(e){var r=new RegExp("[^/]+"),t=e.match(r)[0];return e.replace(t,i(t))}function i(e){return inflection.pluralize(e)}function o(e,t){var n=e.all(t);return n.success=function(e){return n.then(function(t){var n=[];r.forEach(t,function(e){""===e.data?n.push(e.status):n.push(e.data)}),e(n)}),n},n.error=function(e){return n.then(null,function(t){var n=[];r.forEach(t,function(e){n.push(e.status)}),e(n)}),n},n}function f(e){return e.then(function(e){u(e)},function(e){s(e)}),e}function u(e){return e}function s(e){var r;switch(e.status){case 404:r="请求的远端服务不存在!";break;case 500:r="请求的远程服务出错！"}console.log("[http request error]: "+r)}function c(){}function a(e,i,u){function s(i,o){if(r.isString(i)&&""!==i){var s=u.serverUrl+n(i);return r.isObject(o)&&!r.isArray(o)&&(o.hasOwnProperty("count")&&(s+="/count"),s+=t(o)),f(e.get(s))}}function c(t,i){if(r.isString(t)&&""!==t&&r.isArray(i)){var o=u.serverUrl+n(t);return f(e.post(o,i))}}function a(t,f){if(r.isString(t)&&""!==t&&r.isArray(f)){var s=u.serverUrl+n(t),c=[];return r.forEach(f,function(r){c.push(e.put(s,r))}),o(i,c)}}function l(t,f){function c(t){var n=[];return r.forEach(t,function(t){var i;r.isString(t)?i=e.delete(a+"/"+t):r.isObject(t)&&(i=e.delete(a+"/"+t.id)),n.push(i)}),n}if(r.isString(t)&&""!==t){var a=u.serverUrl+n(t);if(r.isArray(f))return o(i,c(f));if(r.isObject(f)){var l,h,d=s(t,f);return d.success=function(e){return l=e,d},d.error=function(e){return h=e,d},d.then(function(e){var t=e.data;d=i.all(c(t)),d.then(function(e){var t=[];r.forEach(e,function(e){t.push(e.status)}),l(t)},function(e){var t=[];r.forEach(e,function(e){t.push(e.status)}),h(t)})}),d}}}function h(i,o,s,c,a){if(r.isString(i)&&""!==i){var l=u.serverUrl+n(i);r.isObject(c)&&!r.isArray(c)&&(l+=t(c));var h;if(s)switch(l=l+"/"+a,o.toLowerCase()){case"get":h=e.get(l);break;case"put":h=e.put(l);break;case"post":h=e.post(l);break;case"del":h=e.delete(l);break;case"delete":h=e.delete(l)}else switch(o.toLowerCase()){case"get":h=e.get(l);break;case"put":h=e.put(l,a);break;case"post":h=e.post(l,a);break;case"del":h=e.delete(l,a);break;case"delete":h=e.delete(l,a)}return f(h)}}function d(){}return u.hasOwnProperty("serverUrl")?(d.find=function(e,r){return s(e,r)},d.create=function(e,r){return c(e,r)},d.update=function(e,r,t){return a(e,r,t)},d.destroy=function(e,r){return l(e,r)},d.customInterface=function(e,r,t,n,i){return h(e,r,t,n,i)},d):"Phoebe load failure!"}function l(e){return d.hasOwnProperty(e)}function h(e){function t(e,t){var n=[];return r.forEach(e,function(e){r.forEach(t,function(r){e.hasOwnProperty(r)&&delete e[r]}),n.push(e)}),n}function n(e,r){return l(e)?d[e]:(this.url=e,this.include=null,this.wherestr=null,this.pkfield=r?r:"id",d[this.url]=this,void 0)}return n.prototype.query=function(t){return r.isObject(t)&&(this.include=t.include,this.wherestr=t),e.find(this.url,t)},n.prototype.save=function(n){return n=r.copy(n),this.include&&(n=t(n,this.include)),e.update(this.url,n,this.pkfield)},n.prototype.delete=function(t){return t=r.copy(t),e.destroy(this.url,t)},n.prototype.setInterface=function(t){var n=this;return r.forEach(t,function(r,t){n[t]=function(n,i){var o=this.url+"/"+t,f=r.hasOwnProperty("method")?r.method:"get",u=r.hasOwnProperty("path")?r.path:!1;return e.customInterface(o,f,u,n,i)}}),d[this.url]=this,this},n}r.module("phoebe.httpService",[]).config(c).factory("PhoebeHttpService",a),c.$inject=["$httpProvider"],a.$inject=["$http","$q","$phoebe"],r.module("phoebe.resource",[]).factory("PhoebeResource",h);var d={};h.$inject=["PhoebeHttpService"]}(window,window.angular);
//# sourceMappingURL=phoebe.min.js.map